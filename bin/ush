--UberSHell
s = ""
local history = {}
local background = false
local x = users.getHome(thread.getUID(coroutine.running()))
shell.setDir(string.sub(x, 2, string.len(x)))
while s ~= "exit" do
  s = s:gsub("^%s*(.-)%s*$", "%1")
  background = false
  if string.match(s, "&$") then
    background = true
  end
  thread.runFile(s, false, not background)
  write(users.getUsernameByUID(thread.getUID(coroutine.running())) .. ":/" .. shell.dir()  .. "# ")
  s = read(nil, history)
  table.insert(history, s)
end
